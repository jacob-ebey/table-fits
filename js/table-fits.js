var TableFits=function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),i=window.MutationObserver||window.WebKitMutationObserver,s=window.addEventListener,n=function(){function n(){e(this,n)}return t(n,null,[{key:"addEvent",value:function(e,t){if(i){var a=new i(function(e,i){(e[0].addedNodes.length||e[0].removedNodes.length)&&t()});a.observe(e,{childList:!0,subtree:!0}),e in n._storage||(n._storage[e]={}),n._storage[e][t]=a}else s&&(e.addEventListener("DOMSubtreeModified",t,!1),e.addEventListener("DOMNodeInserted",t,!1),e.addEventListener("DOMNodeRemoved",t,!1))}},{key:"removeEvent",value:function(e,t){if(i){if(!(e in n._storage))return;if(!(t in n._storage[e]))return;n._storage[e][t].disconnect(),delete n._storage[e][t]}else s&&(e.removeEventListener("DOMSubtreeModified",t,!1),e.removeEventListener("DOMNodeInserted",t,!1),e.removeEventListener("DOMNodeRemoved",t,!1))}}]),n}();n._storage={};var a=function(){function i(t){e(this,i),this._table=t,this._groups={},this._namingGroupIndex={},this._nextGroupIndex=0,this.thead=[],this.mainTitleIndex=[],this.rowsClasses=[],this.rows=[],this._prepare()}return t(i,null,[{key:"make",value:function(e){return new i(e)}}]),t(i,[{key:"_prepare",value:function(){var e=this,t=this._table.querySelectorAll("thead tr");[].forEach.call(t,function(t){e._nextGroupIndex=0,[].forEach.call(t.querySelectorAll("th"),e._prepareTH.bind(e))}),this._prepareRows()}},{key:"_prepareRows",value:function(){var e=this,t=this._table.querySelectorAll("tr"),i=0;[].forEach.call(t,function(t){var s=t.querySelectorAll("td");if(!(s.length<1)){t.classList.length>0&&(e.rowsClasses[i]=Array.prototype.slice.call(t.classList));var n=[];[].forEach.call(s,function(e){n.push({parent:e,childNodes:Array.prototype.slice.call(e.childNodes)})}),e.rows.push(n),++i}})}},{key:"_prepareTH",value:function(e,t){if(e.colSpan&&e.colSpan>1)this._prepareTHColspan(e,t);else if("tableFitsGroup"in e.dataset)this._prepareTHGroup(e,t);else{if((!e.rowSpan||e.rowSpan<=1)&&(this._nextGroupIndex+=1),this._groups[t])return this.thead[this._groups[t]].columns.push(e.innerText),void("tableFits"in e.dataset&&"title"===e.dataset.tableFits&&this.mainTitleIndex.push(this._groups[t].index+t));this.thead[t]=e.innerText,"tableFits"in e.dataset&&"title"===e.dataset.tableFits&&this.mainTitleIndex.push(t)}}},{key:"_prepareTHColspan",value:function(e,t){for(var i=0;i<e.colSpan;++i)this._groups[this._nextGroupIndex]=t,++this._nextGroupIndex;this.thead[t]={index:t,title:e.innerText,columns:[]}}},{key:"_prepareTHGroup",value:function(e,t){var i=e.dataset.tableFitsGroup;i in this._namingGroupIndex||(this._namingGroupIndex[i]=t),this._namingGroupIndex[i]in this.thead||(this.thead[this._namingGroupIndex[i]]={index:this._namingGroupIndex[i],title:i,columns:[]}),this.thead[this._namingGroupIndex[i]].columns.push(e.innerText),this._groups[t]=this._namingGroupIndex[i]}}]),i}(),l=function(){function i(t){e(this,i),this._container=t,this._thead=[],this._mainTitleIndex=[],this._rows=[],this._rowsClasses=[],this._mainClass=null}return t(i,null,[{key:"make",value:function(e){return new i(e)}}]),t(i,[{key:"setMainClass",value:function(e){return this._mainClass=e,this}},{key:"setPrepare",value:function(e){return this._thead=e.thead,this._mainTitleIndex=e.mainTitleIndex,this._rows=e.rows,this._rowsClasses=e.rowsClasses,this}},{key:"create",value:function(){var e=this;this._rows.forEach(function(t,i){var s=document.createElement("div");s.classList.add(e._mainClass+"__tr"),e._container.appendChild(s),e._rowsClasses[i]&&e._rowsClasses[i].forEach(function(e){s.classList.add(e)}),e._mainTitleIndex.length&&s.appendChild(e._createMainTitle(t));var n=document.createElement("div");n.classList.add(e._mainClass+"__body"),s.appendChild(n),e._createRowData(n,t)})}},{key:"_createMainTitle",value:function(e){var t=this,i=document.createElement("div");return i.classList.add(this._mainClass+"__head"),this._mainTitleIndex.forEach(function(s){var n=document.createElement("div");n.classList.add(t._mainClass+"__head__item");var a=!1;if(e[s].childNodes.forEach(function(e){e instanceof HTMLInputElement?a=!0:e instanceof HTMLSelectElement&&(a=!0)}),a){var l=document.createElement("div");l.classList.add(t._mainClass+"__th"),l.appendChild(document.createTextNode(t._thead[s]));var r=document.createElement("div");r.classList.add(t._mainClass+"__td"),e[s].childNodes.forEach(function(e){r.appendChild(e)}),e[s].newParent=r,n.appendChild(l),n.appendChild(r)}else e[s].childNodes.forEach(function(e){n.appendChild(e)}),e[s].newParent=n;i.appendChild(n)}),i}},{key:"_createRowData",value:function(e,t){var i=this,s=0;Object.keys(this._thead).forEach(function(n){var a=i._thead[n],l=document.createElement("div");if(l.classList.add(i._mainClass+"__item"),"string"!=typeof a){var r=document.createElement("div");r.classList.add(i._mainClass+"__columns_title"),r.appendChild(document.createTextNode(a.title));var d=document.createElement("div");d.classList.add(i._mainClass+"__columns"),a.columns.forEach(function(e){if(-1===i._mainTitleIndex.indexOf(s)){var n=document.createElement("div");n.classList.add(i._mainClass+"__columns__col");var a=document.createElement("div");a.classList.add(i._mainClass+"__th"),a.appendChild(document.createTextNode(e));var l=document.createElement("div");l.classList.add(i._mainClass+"__td"),t[s].childNodes.forEach(function(e){l.appendChild(e)}),t[s].newParent=l,n.appendChild(a),n.appendChild(l),d.appendChild(n),++s}else++s}),l.appendChild(r),l.appendChild(d)}else{if(-1!==i._mainTitleIndex.indexOf(s))return void++s;var o=document.createElement("div");o.classList.add(i._mainClass+"__th"),o.appendChild(document.createTextNode(a));var h=document.createElement("div");h.classList.add(i._mainClass+"__td"),t[s].childNodes.forEach(function(e){h.appendChild(e)}),t[s].newParent=h,l.appendChild(o),l.appendChild(h),++s}e.appendChild(l)})}}]),i}();return function(){function i(t,s){e(this,i),this._config={mainClass:"table-fits",resize:!0,watch:!0},this._el="string"==typeof t?document.querySelector(t):t,this._parent=this._el.parentNode,this._parentCS=getComputedStyle(this._parent),this._el&&this._el.querySelector("thead")&&("tableFits"in this._el.dataset&&"no"===this._el.dataset.tableFits||(this._config=Object.assign({},this._config,s),this._el._tableFits&&this._el._tableFits.destroy(),this._el._tableFits=this,this._isTableFits=!1,this._elMinWidth=null,this._mainTitleIndex=[],this._thead=[],this._rows=[],this._rowsClasses=[],this._tableFitsEl=null,this._initHadler=this.onResize.bind(this),this._reloadHadler=this.onReload.bind(this),this._init(),this._initEvent()))}return t(i,null,[{key:"make",value:function(e,t){return new i(e,t)}}]),t(i,[{key:"_initEvent",value:function(){this._config.resize&&window.addEventListener("resize",this._initHadler,!0),this._config.watch&&n.addEvent(this._el,this._reloadHadler)}},{key:"_offEvent",value:function(){this._config.resize&&window.removeEventListener("resize",this._initHadler,!0),this._config.watch&&n.removeEvent(this._el,this._reloadHadler)}},{key:"onResize",value:function(){this._offEvent(),this._init(),this._initEvent()}},{key:"onReload",value:function(){this._offEvent(),this._showTableDefault(),this.reset(),this._init(),this._initEvent()}},{key:"reset",value:function(){this._isTableFits=!1,this._tableFitsEl=null,this._elMinWidth=null,this._mainTitleIndex=[],this._thead=[],this._rows=[],this._rowsClasses=[]}},{key:"destroy",value:function(){this._offEvent(),this._showTableDefault(),this.reset(),this._el._tableFits=null}},{key:"_returnChildrenTo",value:function(e){this._rows.forEach(function(t){t.forEach(function(t){t.childNodes.forEach(function(i){"table"===e?t.parent.appendChild(i):t.newParent.appendChild(i)})})})}},{key:"_showTableDefault",value:function(){this._tableFitsEl&&this._isTableFits&&(this._isTableFits=!1,this._returnChildrenTo("table"),this._el.style.display="table",this._tableFitsEl.parentNode.removeChild(this._tableFitsEl))}},{key:"_isNeedTableFits",value:function(){return this._parent.clientWidth-parseFloat(this._parentCS.getPropertyValue("padding-left"))-parseFloat(this._parentCS.getPropertyValue("padding-right"))<(this._elMinWidth?this._elMinWidth:this._el.offsetWidth)}},{key:"_init",value:function(){if(this._isNeedTableFits()){if(!this._isTableFits){this._isTableFits=!0,this._elMinWidth||(this._elMinWidth=this._el.offsetWidth),this._tableFitsEl?this._returnChildrenTo("mobile-block"):(this._prepareTableFits(),this._createTableFits()),this._el.style.display="none";var e=this._el.parentNode,t=this._el.nextSibling;t?e.insertBefore(this._tableFitsEl,t):e.appendChild(this._tableFitsEl)}}else this._showTableDefault()}},{key:"_prepareTableFits",value:function(){this._prepare=a.make(this._el),this._thead=this._prepare.thead,this._mainTitleIndex=this._prepare.mainTitleIndex,this._rows=this._prepare.rows,this._rowsClasses=this._prepare.rowsClasses}},{key:"_createTableFits",value:function(){this._tableFitsEl=document.createElement("div"),this._tableFitsEl.classList.add(this._config.mainClass),l.make(this._tableFitsEl).setMainClass(this._config.mainClass).setPrepare(this._prepare).create()}}]),i}()}();
