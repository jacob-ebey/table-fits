var TableFits=function(){"use strict";var e=window.MutationObserver||window.WebKitMutationObserver,t=window.addEventListener,i=function(){};i.addEvent=function(s,n){if(e){var a=new e(function(e,t){(e[0].addedNodes.length||e[0].removedNodes.length)&&n()});a.observe(s,{childList:!0,subtree:!0}),s in i._storage||(i._storage[s]={}),i._storage[s][n]=a}else t&&(s.addEventListener("DOMSubtreeModified",n,!1),s.addEventListener("DOMNodeInserted",n,!1),s.addEventListener("DOMNodeRemoved",n,!1))},i.removeEvent=function(s,n){if(e){if(!(s in i._storage))return;if(!(n in i._storage[s]))return;i._storage[s][n].disconnect(),delete i._storage[s][n]}else t&&(s.removeEventListener("DOMSubtreeModified",n,!1),s.removeEventListener("DOMNodeInserted",n,!1),s.removeEventListener("DOMNodeRemoved",n,!1))},i._storage={};var s=function(e){this._table=e,this._groups={},this._namingGroupIndex={},this._nextGroupIndex=0,this.thead=[],this.mainTitleIndex=[],this.rowsClasses=[],this.rows=[],this._prepare()};s.make=function(e){return new s(e)},s.prototype._prepare=function(){var e=this,t=this._table.querySelectorAll("thead tr");[].forEach.call(t,function(t){e._nextGroupIndex=0,[].forEach.call(t.querySelectorAll("th"),e._prepareTH.bind(e))}),this._prepareRows()},s.prototype._prepareRows=function(){var e=this,t=this._table.querySelectorAll("tr"),i=0;[].forEach.call(t,function(t){var s=t.querySelectorAll("td");if(!(s.length<1)){t.classList.length>0&&(e.rowsClasses[i]=Array.prototype.slice.call(t.classList));var n=[];[].forEach.call(s,function(e){n.push({parent:e,childNodes:Array.prototype.slice.call(e.childNodes)})}),e.rows.push(n),++i}})},s.prototype._prepareTH=function(e,t){if(e.colSpan&&e.colSpan>1)this._prepareTHColspan(e,t);else if("tableFitsGroup"in e.dataset)this._prepareTHGroup(e,t);else{if((!e.rowSpan||e.rowSpan<=1)&&(this._nextGroupIndex+=1),this._groups[t])return this.thead[this._groups[t]].columns.push(e.innerText),void("tableFits"in e.dataset&&"title"===e.dataset.tableFits&&this.mainTitleIndex.push(this._groups[t].index+t));this.thead[t]=e.innerText,"tableFits"in e.dataset&&"title"===e.dataset.tableFits&&this.mainTitleIndex.push(t)}},s.prototype._prepareTHColspan=function(e,t){for(var i=this,s=0;s<e.colSpan;++s)i._groups[i._nextGroupIndex]=t,++i._nextGroupIndex;this.thead[t]={index:t,title:e.innerText,columns:[]}},s.prototype._prepareTHGroup=function(e,t){var i=e.dataset.tableFitsGroup;i in this._namingGroupIndex||(this._namingGroupIndex[i]=t),this._namingGroupIndex[i]in this.thead||(this.thead[this._namingGroupIndex[i]]={index:this._namingGroupIndex[i],title:i,columns:[]}),this.thead[this._namingGroupIndex[i]].columns.push(e.innerText),this._groups[t]=this._namingGroupIndex[i]};var n=function(e){this._container=e,this._thead=[],this._mainTitleIndex=[],this._rows=[],this._rowsClasses=[],this._mainClass=null};n.make=function(e){return new n(e)},n.prototype.setMainClass=function(e){return this._mainClass=e,this},n.prototype.setPrepare=function(e){return this._thead=e.thead,this._mainTitleIndex=e.mainTitleIndex,this._rows=e.rows,this._rowsClasses=e.rowsClasses,this},n.prototype.create=function(){var e=this;this._rows.forEach(function(t,i){var s=document.createElement("div");s.classList.add(e._mainClass+"__tr"),e._container.appendChild(s),e._rowsClasses[i]&&e._rowsClasses[i].forEach(function(e){s.classList.add(e)}),e._mainTitleIndex.length&&s.appendChild(e._createMainTitle(t));var n=document.createElement("div");n.classList.add(e._mainClass+"__body"),s.appendChild(n),e._createRowData(n,t)})},n.prototype._createMainTitle=function(e){var t=this,i=document.createElement("div");return i.classList.add(this._mainClass+"__head"),this._mainTitleIndex.forEach(function(s){var n=document.createElement("div");n.classList.add(t._mainClass+"__head__item");var a=!1;if(e[s].childNodes.forEach(function(e){e instanceof HTMLInputElement?a=!0:e instanceof HTMLSelectElement&&(a=!0)}),a){var r=document.createElement("div");r.classList.add(t._mainClass+"__th"),r.appendChild(document.createTextNode(t._thead[s]));var l=document.createElement("div");l.classList.add(t._mainClass+"__td"),e[s].childNodes.forEach(function(e){l.appendChild(e)}),e[s].newParent=l,n.appendChild(r),n.appendChild(l)}else e[s].childNodes.forEach(function(e){n.appendChild(e)}),e[s].newParent=n;i.appendChild(n)}),i},n.prototype._createRowData=function(e,t){var i=this,s=0;Object.keys(this._thead).forEach(function(n){var a=i._thead[n],r=document.createElement("div");if(r.classList.add(i._mainClass+"__item"),"string"!=typeof a){var l=document.createElement("div");l.classList.add(i._mainClass+"__columns_title"),l.appendChild(document.createTextNode(a.title));var o=document.createElement("div");o.classList.add(i._mainClass+"__columns"),a.columns.forEach(function(e){if(-1===i._mainTitleIndex.indexOf(s)){var n=document.createElement("div");n.classList.add(i._mainClass+"__columns__col");var a=document.createElement("div");a.classList.add(i._mainClass+"__th"),a.appendChild(document.createTextNode(e));var r=document.createElement("div");r.classList.add(i._mainClass+"__td"),t[s].childNodes.forEach(function(e){r.appendChild(e)}),t[s].newParent=r,n.appendChild(a),n.appendChild(r),o.appendChild(n),++s}else++s}),r.appendChild(l),r.appendChild(o)}else{if(-1!==i._mainTitleIndex.indexOf(s))return void++s;var d=document.createElement("div");d.classList.add(i._mainClass+"__th"),d.appendChild(document.createTextNode(a));var h=document.createElement("div");h.classList.add(i._mainClass+"__td"),t[s].childNodes.forEach(function(e){h.appendChild(e)}),t[s].newParent=h,r.appendChild(d),r.appendChild(h),++s}e.appendChild(r)})};var a=function(e,t){this._config={mainClass:"table-fits",resize:!0,watch:!0},this._el="string"==typeof e?document.querySelector(e):e,this._parent=this._el.parentNode,this._parentCS=getComputedStyle(this._parent),this._el&&this._el.querySelector("thead")&&("tableFits"in this._el.dataset&&"no"===this._el.dataset.tableFits||(this._config=Object.assign({},this._config,t),this._el._tableFits&&this._el._tableFits.destroy(),this._el._tableFits=this,this._isTableFits=!1,this._elMinWidth=null,this._mainTitleIndex=[],this._thead=[],this._rows=[],this._rowsClasses=[],this._tableFitsEl=null,this._initHadler=this.onResize.bind(this),this._reloadHadler=this.onReload.bind(this),this._init(),this._initEvent()))};return a.make=function(e,t){return new a(e,t)},a.prototype._initEvent=function(){this._config.resize&&window.addEventListener("resize",this._initHadler,!0),this._config.watch&&i.addEvent(this._el,this._reloadHadler)},a.prototype._offEvent=function(){this._config.resize&&window.removeEventListener("resize",this._initHadler,!0),this._config.watch&&i.removeEvent(this._el,this._reloadHadler)},a.prototype.onResize=function(){this._offEvent(),this._init(),this._initEvent()},a.prototype.onReload=function(){this._offEvent(),this._showTableDefault(),this.reset(),this._init(),this._initEvent()},a.prototype.reset=function(){this._isTableFits=!1,this._tableFitsEl=null,this._elMinWidth=null,this._mainTitleIndex=[],this._thead=[],this._rows=[],this._rowsClasses=[]},a.prototype.destroy=function(){this._offEvent(),this._showTableDefault(),this.reset(),this._el._tableFits=null},a.prototype._returnChildrenTo=function(e){this._rows.forEach(function(t){t.forEach(function(t){t.childNodes.forEach(function(i){"table"===e?t.parent.appendChild(i):t.newParent.appendChild(i)})})})},a.prototype._showTableDefault=function(){this._tableFitsEl&&this._isTableFits&&(this._isTableFits=!1,this._returnChildrenTo("table"),this._el.style.display="table",this._tableFitsEl.parentNode.removeChild(this._tableFitsEl))},a.prototype._isNeedTableFits=function(){return this._parent.clientWidth-parseFloat(this._parentCS.getPropertyValue("padding-left"))-parseFloat(this._parentCS.getPropertyValue("padding-right"))<(this._elMinWidth?this._elMinWidth:this._el.offsetWidth)},a.prototype._init=function(){if(this._isNeedTableFits()){if(!this._isTableFits){this._isTableFits=!0,this._elMinWidth||(this._elMinWidth=this._el.offsetWidth),this._tableFitsEl?this._returnChildrenTo("mobile-block"):(this._prepareTableFits(),this._createTableFits()),this._el.style.display="none";var e=this._el.parentNode,t=this._el.nextSibling;t?e.insertBefore(this._tableFitsEl,t):e.appendChild(this._tableFitsEl)}}else this._showTableDefault()},a.prototype._prepareTableFits=function(){this._prepare=s.make(this._el),this._thead=this._prepare.thead,this._mainTitleIndex=this._prepare.mainTitleIndex,this._rows=this._prepare.rows,this._rowsClasses=this._prepare.rowsClasses},a.prototype._createTableFits=function(){this._tableFitsEl=document.createElement("div"),this._tableFitsEl.classList.add(this._config.mainClass),n.make(this._tableFitsEl).setMainClass(this._config.mainClass).setPrepare(this._prepare).create()},a}();
