var TableFits=function(){"use strict";function t(t,e){var i=document.createElement(t);return void 0!==e&&i.classList.add(e),i}var e=window.MutationObserver||window.WebKitMutationObserver,i=window.addEventListener,s=function(){};s.addEvent=function(t,n){if(e){var a=new e(function(t,e){(t[0].addedNodes.length||t[0].removedNodes.length)&&n()});a.observe(t,{childList:!0,subtree:!0}),t in s._storage||(s._storage[t]={}),s._storage[t][n]=a}else i&&(t.addEventListener("DOMSubtreeModified",n,!1),t.addEventListener("DOMNodeInserted",n,!1),t.addEventListener("DOMNodeRemoved",n,!1))},s.removeEvent=function(t,n){if(e){if(!(t in s._storage))return;if(!(n in s._storage[t]))return;s._storage[t][n].disconnect(),delete s._storage[t][n]}else i&&(t.removeEventListener("DOMSubtreeModified",n,!1),t.removeEventListener("DOMNodeInserted",n,!1),t.removeEventListener("DOMNodeRemoved",n,!1))},s._storage={};var n=function(t){this._table=t,this._groups={},this._namingGroupIndex={},this._nextGroupIndex=0,this.thead=[],this.mainTitleIndex=[],this.rowsClasses=[],this.rows=[],this._prepare()};n.make=function(t){return new n(t)},n.prototype._prepare=function(){var t=this,e=this._table.querySelectorAll("thead tr");[].forEach.call(e,function(e){t._nextGroupIndex=0,[].forEach.call(e.querySelectorAll("th"),t._prepareTH.bind(t))}),this._prepareRows()},n.prototype._prepareRows=function(){var t=this,e=this._table.querySelectorAll("tr"),i=0;[].forEach.call(e,function(e){var s=e.querySelectorAll("td");if(!(s.length<1)){e.classList.length>0&&(t.rowsClasses[i]=Array.prototype.slice.call(e.classList));var n=[];[].forEach.call(s,function(t){n.push({parent:t,childNodes:Array.prototype.slice.call(t.childNodes)})}),t.rows.push(n),++i}})},n.prototype._prepareTH=function(t,e){if(t.colSpan&&t.colSpan>1)this._prepareTHColspan(t,e);else if("tableFitsGroup"in t.dataset)this._prepareTHGroup(t,e);else{if((!t.rowSpan||t.rowSpan<=1)&&(this._nextGroupIndex+=1),void 0!==this._groups[e]&&t.parentNode.rowIndex>0)return this.thead[this._groups[e]].columns.push(t.innerText),void("tableFits"in t.dataset&&"title"===t.dataset.tableFits&&this.mainTitleIndex.push(this._groups[e].index+e));this.thead[e]=t.innerText,"tableFits"in t.dataset&&"title"===t.dataset.tableFits&&this.mainTitleIndex.push(e)}},n.prototype._prepareTHColspan=function(t,e){for(var i=this,s=0;s<t.colSpan;++s)i._groups[i._nextGroupIndex]=e,++i._nextGroupIndex;this.thead[e]={index:e,title:t.innerText,columns:[]}},n.prototype._prepareTHGroup=function(t,e){var i=t.dataset.tableFitsGroup;i in this._namingGroupIndex||(this._namingGroupIndex[i]=e),this._namingGroupIndex[i]in this.thead||(this.thead[this._namingGroupIndex[i]]={index:this._namingGroupIndex[i],title:i,columns:[]}),this.thead[this._namingGroupIndex[i]].columns.push(t.innerText),this._groups[e]=this._namingGroupIndex[i]};var a=function(t){this._container=t,this._thead=[],this._mainTitleIndex=[],this._rows=[],this._rowsClasses=[],this._mainClass=null};a.make=function(t){return new a(t)},a.prototype.setMainClass=function(t){return this._mainClass=t,this},a.prototype.setPrepare=function(t){return this._thead=t.thead,this._mainTitleIndex=t.mainTitleIndex,this._rows=t.rows,this._rowsClasses=t.rowsClasses,this},a.prototype.create=function(){var e=this;this._rows.forEach(function(i,s){var n=t("div",e._mainClass+"__tr");e._container.appendChild(n),e._rowsClasses[s]&&e._rowsClasses[s].forEach(function(t){n.classList.add(t)}),e._mainTitleIndex.length&&n.appendChild(e._createMainTitle(i));var a=t("div",e._mainClass+"__body");n.appendChild(a),e._createRowData(a,i)})},a.prototype._createMainTitle=function(e){var i=this,s=t("div",this._mainClass+"__head");return this._mainTitleIndex.forEach(function(n){var a=t("div",i._mainClass+"__head__item"),r=!1;if(e[n].childNodes.forEach(function(t){t instanceof HTMLInputElement?r=!0:t instanceof HTMLSelectElement&&(r=!0)}),r){var o=t("div",i._mainClass+"__th");o.appendChild(document.createTextNode(i._thead[n]));var l=t("div",i._mainClass+"__td");e[n].childNodes.forEach(function(t){l.appendChild(t)}),e[n].newParent=l,a.appendChild(o),a.appendChild(l)}else e[n].childNodes.forEach(function(t){a.appendChild(t)}),e[n].newParent=a;s.appendChild(a)}),s},a.prototype._createRowData=function(e,i){var s=this,n=0;Object.keys(this._thead).forEach(function(a){var r=s._thead[a],o=t("div",s._mainClass+"__item");if("string"!=typeof r){var l=t("div",s._mainClass+"__columns_title");l.appendChild(document.createTextNode(r.title));var h=t("div",s._mainClass+"__columns");r.columns.forEach(function(e){if(-1===s._mainTitleIndex.indexOf(n)){var a=t("div",s._mainClass+"__columns__col"),r=t("div",s._mainClass+"__th");r.appendChild(document.createTextNode(e));var o=t("div",s._mainClass+"__td");i[n].childNodes.forEach(function(t){o.appendChild(t)}),i[n].newParent=o,a.appendChild(r),a.appendChild(o),h.appendChild(a),++n}else++n}),o.appendChild(l),o.appendChild(h)}else{if(-1!==s._mainTitleIndex.indexOf(n))return void++n;var d=t("div",s._mainClass+"__th");d.appendChild(document.createTextNode(r));var _=t("div",s._mainClass+"__td");i[n].childNodes.forEach(function(t){_.appendChild(t)}),i[n].newParent=_,o.appendChild(d),o.appendChild(_),++n}e.appendChild(o)})};var r=function(t,e){this._config={mainClass:"table-fits",resize:!0,watch:!0},this._el="string"==typeof t?document.querySelector(t):t,this._parent=this._el.parentNode,this._parentCS=getComputedStyle(this._parent),this._el&&this._el.querySelector("thead")&&("tableFits"in this._el.dataset&&"no"===this._el.dataset.tableFits||(this._config=Object.assign({},this._config,e),this._el._tableFits&&this._el._tableFits.destroy(),this._el._tableFits=this,this._isTableFits=!1,this._elMinWidth=null,this._mainTitleIndex=[],this._thead=[],this._rows=[],this._rowsClasses=[],this._tableFitsEl=null,this._initHadler=this.onResize.bind(this),this._reloadHadler=this.onReload.bind(this),this._init(),this._initEvent()))};return r.make=function(t,e){return new r(t,e)},r.prototype._initEvent=function(){this._config.resize&&window.addEventListener("resize",this._initHadler,!0),this._config.watch&&this._isTableFits&&s.addEvent(this._el,this._reloadHadler)},r.prototype._offEvent=function(){this._config.resize&&window.removeEventListener("resize",this._initHadler,!0),this._config.watch&&s.removeEvent(this._el,this._reloadHadler)},r.prototype.onResize=function(){this._offEvent(),this._init(),this._initEvent()},r.prototype.onReload=function(){this._offEvent(),this._showTableDefault(),this.reset(),this._init(),this._initEvent()},r.prototype.reset=function(){this._isTableFits=!1,this._tableFitsEl=null,this._elMinWidth=null,this._mainTitleIndex=[],this._thead=[],this._rows=[],this._rowsClasses=[]},r.prototype.destroy=function(){this._offEvent(),this._showTableDefault(),this.reset(),this._el._tableFits=null},r.prototype._returnChildrenTo=function(t){this._rows.forEach(function(e){e.forEach(function(e){e.childNodes.forEach(function(i){"table"===t?e.parent.appendChild(i):e.newParent.appendChild(i)})})})},r.prototype._showTableDefault=function(){this._tableFitsEl&&this._isTableFits&&(this._isTableFits=!1,this._returnChildrenTo("table"),this._el.style.display="table",this._tableFitsEl.parentNode.removeChild(this._tableFitsEl))},r.prototype._isNeedTableFits=function(){return this._parent.clientWidth-parseFloat(this._parentCS.getPropertyValue("padding-left"))-parseFloat(this._parentCS.getPropertyValue("padding-right"))<(this._elMinWidth?this._elMinWidth:this._el.offsetWidth)},r.prototype._init=function(){if(this._isNeedTableFits()){if(!this._isTableFits){this._isTableFits=!0,this._elMinWidth||(this._elMinWidth=this._el.offsetWidth),this._tableFitsEl?this._returnChildrenTo("mobile-block"):(this._prepareTableFits(),this._createTableFits()),this._el.style.display="none";var t=this._el.parentNode,e=this._el.nextSibling;e?t.insertBefore(this._tableFitsEl,e):t.appendChild(this._tableFitsEl)}}else this._showTableDefault()},r.prototype._prepareTableFits=function(){this._prepare=n.make(this._el),this._thead=this._prepare.thead,this._mainTitleIndex=this._prepare.mainTitleIndex,this._rows=this._prepare.rows,this._rowsClasses=this._prepare.rowsClasses},r.prototype._createTableFits=function(){this._tableFitsEl=document.createElement("div"),this._tableFitsEl.classList.add(this._config.mainClass),a.make(this._tableFitsEl).setMainClass(this._config.mainClass).setPrepare(this._prepare).create()},r}();
