var tableFits=function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),i=window.MutationObserver||window.WebKitMutationObserver,n=window.addEventListener,s=function(){function s(){e(this,s)}return t(s,null,[{key:"addEvent",value:function(e,t){if(i){var a=new i(function(e,i){(e[0].addedNodes.length||e[0].removedNodes.length)&&t()});a.observe(e,{childList:!0,subtree:!0}),e in s._storage||(s._storage[e]={}),s._storage[e][t]=a}else n&&(e.addEventListener("DOMSubtreeModified",t,!1),e.addEventListener("DOMNodeInserted",t,!1),e.addEventListener("DOMNodeRemoved",t,!1))}},{key:"removeEvent",value:function(e,t){if(i){if(!(e in s._storage))return;if(!(t in s._storage[e]))return;s._storage[e][t].disconnect(),delete s._storage[e][t]}else n&&(e.removeEventListener("DOMSubtreeModified",t,!1),e.removeEventListener("DOMNodeInserted",t,!1),e.removeEventListener("DOMNodeRemoved",t,!1))}}]),s}();s._storage={};var a=function(){function i(t){e(this,i),this._table=t,this._groups={},this._namingGroupIndex={},this._nextGroupIndex=0,this.thead=[],this.mainTitleIndex=[],this.rowsClasses=[],this.rows=[],this._prepare()}return t(i,null,[{key:"make",value:function(e){return new i(e)}}]),t(i,[{key:"_prepare",value:function(){var e=this,t=this._table.querySelectorAll("thead tr");[].forEach.call(t,function(t){e._nextGroupIndex=0,[].forEach.call(t.querySelectorAll("th"),e._prepareTH.bind(e))}),0===this.mainTitleIndex.length&&(this.mainTitleIndex=[0]),this._prepareRows()}},{key:"_prepareRows",value:function(){var e=this,t=this._table.querySelectorAll("tr"),i=0;[].forEach.call(t,function(t){var n=t.querySelectorAll("td");if(!(n.length<1)){t.classList.length>0&&(e.rowsClasses[i]=Array.prototype.slice.call(t.classList));var s=[];[].forEach.call(n,function(e){s.push({parent:e,childNodes:Array.prototype.slice.call(e.childNodes)})}),e.rows.push(s),++i}})}},{key:"_prepareTH",value:function(e,t){if(e.colSpan&&e.colSpan>1)this._prepareTHColspan(e,t);else if("tableFitsGroup"in e.dataset)this._prepareTHGroup(e,t);else{if((!e.rowSpan||e.rowSpan<=1)&&(this._nextGroupIndex+=1),this._groups[t])return this.thead[this._groups[t]].columns.push(e.innerText),void("tableFits"in e.dataset&&"title"===e.dataset.tableFits&&this.mainTitleIndex.push(this._groups[t].index+t));this.thead[t]=e.innerText,"tableFits"in e.dataset&&"title"===e.dataset.tableFits&&this.mainTitleIndex.push(t)}}},{key:"_prepareTHColspan",value:function(e,t){for(var i=0;i<e.colSpan;++i)this._groups[this._nextGroupIndex]=t,++this._nextGroupIndex;this.thead[t]={index:t,title:e.innerText,columns:[]}}},{key:"_prepareTHGroup",value:function(e,t){var i=e.dataset.tableFitsGroup;i in this._namingGroupIndex||(this._namingGroupIndex[i]=t),this._namingGroupIndex[i]in this.thead||(this.thead[this._namingGroupIndex[i]]={index:this._namingGroupIndex[i],title:i,columns:[]}),this.thead[this._namingGroupIndex[i]].columns.push(e.innerText),this._groups[t]=this._namingGroupIndex[i]}}]),i}(),l=function(){function i(t){e(this,i),this._container=t,this._thead=[],this._mainTitleIndex=[],this._rows=[],this._rowsClasses=[],this._mainClass=null}return t(i,null,[{key:"make",value:function(e){return new i(e)}}]),t(i,[{key:"setMainClass",value:function(e){return this._mainClass=e,this}},{key:"setPrepare",value:function(e){return this._thead=e.thead,this._mainTitleIndex=e.mainTitleIndex,this._rows=e.rows,this._rowsClasses=e.rowsClasses,this}},{key:"create",value:function(){var e=this;this._rows.forEach(function(t,i){var n=document.createElement("div");n.classList.add(e._mainClass+"__tr"),e._container.appendChild(n),e._rowsClasses[i]&&e._rowsClasses[i].forEach(function(e){n.classList.add(e)}),n.appendChild(e._createMainTitle(t));var s=document.createElement("div");s.classList.add(e._mainClass+"__body"),n.appendChild(s),e._createRowData(s,t)})}},{key:"_createMainTitle",value:function(e){var t=this,i=document.createElement("div");return i.classList.add(this._mainClass+"__head"),this._mainTitleIndex.forEach(function(n){var s=document.createElement("div");s.classList.add(t._mainClass+"__head__item");var a=!1;if(e[n].childNodes.forEach(function(e){e instanceof HTMLInputElement?a=!0:e instanceof HTMLSelectElement&&(a=!0)}),a){var l=document.createElement("div");l.classList.add(t._mainClass+"__th"),l.appendChild(document.createTextNode(t._thead[n]));var d=document.createElement("div");d.classList.add(t._mainClass+"__td"),e[n].childNodes.forEach(function(e){d.appendChild(e)}),e[n].newParent=d,s.appendChild(l),s.appendChild(d)}else e[n].childNodes.forEach(function(e){s.appendChild(e)}),e[n].newParent=s;i.appendChild(s)}),i}},{key:"_createRowData",value:function(e,t){var i=this,n=0;Object.keys(this._thead).forEach(function(s){var a=i._thead[s],l=document.createElement("div");if(l.classList.add(i._mainClass+"__item"),"string"!=typeof a){var d=document.createElement("div");d.classList.add(i._mainClass+"__columns_title"),d.appendChild(document.createTextNode(a.title));var r=document.createElement("div");r.classList.add(i._mainClass+"__columns"),a.columns.forEach(function(e){if(-1===i._mainTitleIndex.indexOf(n)){var s=document.createElement("div");s.classList.add(i._mainClass+"__columns__col");var a=document.createElement("div");a.classList.add(i._mainClass+"__th"),a.appendChild(document.createTextNode(e));var l=document.createElement("div");l.classList.add(i._mainClass+"__td"),t[n].childNodes.forEach(function(e){l.appendChild(e)}),t[n].newParent=l,s.appendChild(a),s.appendChild(l),r.appendChild(s),++n}else++n}),l.appendChild(d),l.appendChild(r)}else{if(-1!==i._mainTitleIndex.indexOf(n))return void++n;var o=document.createElement("div");o.classList.add(i._mainClass+"__th"),o.appendChild(document.createTextNode(a));var h=document.createElement("div");h.classList.add(i._mainClass+"__td"),t[n].childNodes.forEach(function(e){h.appendChild(e)}),t[n].newParent=h,l.appendChild(o),l.appendChild(h),++n}e.appendChild(l)})}}]),i}();return function(){function i(t,n){e(this,i),this._config={mainClass:"table-fits",resize:!0,watch:!0},this._el="string"==typeof t?document.querySelector(t):t,this._el&&this._el.querySelector("thead")&&("tableFits"in this._el.dataset&&"no"===this._el.dataset.tableFits||(this._config=Object.assign({},this._config,n),this._el._tableFits&&this._el._tableFits.destroy(),this._el._tableFits=this,this._isTableFits=!1,this._elMinWidth=null,this._mainTitleIndex=[],this._thead=[],this._rows=[],this._rowsClasses=[],this._tableFitsEl=null,this._initHadler=this.onResize.bind(this),this._reloadHadler=this.onReload.bind(this),this._init(),this._initEvent()))}return t(i,null,[{key:"make",value:function(e,t){return new i(e,t)}}]),t(i,[{key:"_initEvent",value:function(){this._config.resize&&window.addEventListener("resize",this._initHadler,!0),this._config.watch&&s.addEvent(this._el,this._reloadHadler)}},{key:"_offEvent",value:function(){this._config.resize&&window.removeEventListener("resize",this._initHadler,!0),this._config.watch&&s.removeEvent(this._el,this._reloadHadler)}},{key:"onResize",value:function(){this._offEvent(),this._init(),this._initEvent()}},{key:"onReload",value:function(){this._offEvent(),this._showTableDefault(),this.reset(),this._init(),this._initEvent()}},{key:"reset",value:function(){this._isTableFits=!1,this._tableFitsEl=null,this._elMinWidth=null,this._mainTitleIndex=[],this._thead=[],this._rows=[],this._rowsClasses=[]}},{key:"destroy",value:function(){this._offEvent(),this._showTableDefault(),this.reset(),this._el._tableFits=null}},{key:"_returnChildrenToTable",value:function(){this._rows.forEach(function(e){e.forEach(function(e){e.childNodes.forEach(function(t){e.parent.appendChild(t)})})})}},{key:"_returnChildrenToMobileBlock",value:function(){this._rows.forEach(function(e){e.forEach(function(e){e.childNodes.forEach(function(t){e.newParent.appendChild(t)})})})}},{key:"_showTableDefault",value:function(){this._tableFitsEl&&this._isTableFits&&(this._isTableFits=!1,this._returnChildrenToTable(),this._el.style.display="table",this._tableFitsEl.parentNode.removeChild(this._tableFitsEl))}},{key:"_isNeedTableFits",value:function(){if(this._elMinWidth){if(this._el.parentNode.offsetWidth>=this._elMinWidth)return!1}else if(this._el.parentNode.offsetWidth>=this._el.offsetWidth)return!1;return!0}},{key:"_init",value:function(){if(this._isNeedTableFits()){if(!this._isTableFits){this._isTableFits=!0,this._elMinWidth||(this._elMinWidth=this._el.offsetWidth),this._tableFitsEl?this._returnChildrenToMobileBlock():(this._prepareTableFits(),this._createTableFits()),this._el.style.display="none";var e=this._el.parentNode,t=this._el.nextSibling;t?e.insertBefore(this._tableFitsEl,t):e.appendChild(this._tableFitsEl)}}else this._showTableDefault()}},{key:"_prepareTableFits",value:function(){this._prepare=a.make(this._el),this._thead=this._prepare.thead,this._mainTitleIndex=this._prepare.mainTitleIndex,this._rows=this._prepare.rows,this._rowsClasses=this._prepare.rowsClasses}},{key:"_createTableFits",value:function(){var e=this;this._tableFitsEl=document.createElement("div"),this._tableFitsEl.classList.add(this._config.mainClass),l.make(this._tableFitsEl).setMainClass(this._config.mainClass).setPrepare(this._prepare).create(),this._rows.forEach(function(t,i){var n=document.createElement("div");n.classList.add(e._config.mainClass+"__tr"),e._tableFitsEl.appendChild(n),e._rowsClasses[i]&&e._rowsClasses[i].forEach(function(e){n.classList.add(e)});var s=document.createElement("div");s.classList.add(e._config.mainClass+"__head"),e._mainTitleIndex.forEach(function(i){var n=document.createElement("div");n.classList.add(e._config.mainClass+"__head__item");var a=!1;if(t[i].childNodes.forEach(function(e){e instanceof HTMLInputElement?a=!0:e instanceof HTMLSelectElement&&(a=!0)}),a){var l=document.createElement("div");l.classList.add(e._config.mainClass+"__th"),l.appendChild(document.createTextNode(e._thead[i]));var d=document.createElement("div");d.classList.add(e._config.mainClass+"__td"),t[i].childNodes.forEach(function(e){d.appendChild(e)}),t[i].newParent=d,n.appendChild(l),n.appendChild(d)}else t[i].childNodes.forEach(function(e){n.appendChild(e)}),t[i].newParent=n;s.appendChild(n)}),n.appendChild(s);var a=document.createElement("div");a.classList.add(e._config.mainClass+"__body"),n.appendChild(a),e._createRowData(a,t)})}},{key:"_createRowData",value:function(e,t){var i=this,n=0;Object.keys(this._thead).forEach(function(s){var a=i._thead[s],l=document.createElement("div");if(l.classList.add(i._config.mainClass+"__item"),"string"!=typeof a){var d=document.createElement("div");d.classList.add(i._config.mainClass+"__columns_title"),d.appendChild(document.createTextNode(a.title));var r=document.createElement("div");r.classList.add(i._config.mainClass+"__columns"),a.columns.forEach(function(e){if(-1===i._mainTitleIndex.indexOf(n)){var s=document.createElement("div");s.classList.add(i._config.mainClass+"__columns__col");var a=document.createElement("div");a.classList.add(i._config.mainClass+"__th"),a.appendChild(document.createTextNode(e));var l=document.createElement("div");l.classList.add(i._config.mainClass+"__td"),t[n].childNodes.forEach(function(e){l.appendChild(e)}),t[n].newParent=l,s.appendChild(a),s.appendChild(l),r.appendChild(s),++n}else++n}),l.appendChild(d),l.appendChild(r)}else{if(-1!==i._mainTitleIndex.indexOf(n))return void++n;var o=document.createElement("div");o.classList.add(i._config.mainClass+"__th"),o.appendChild(document.createTextNode(a));var h=document.createElement("div");h.classList.add(i._config.mainClass+"__td"),t[n].childNodes.forEach(function(e){h.appendChild(e)}),t[n].newParent=h,l.appendChild(o),l.appendChild(h),++n}e.appendChild(l)})}}]),i}()}();
